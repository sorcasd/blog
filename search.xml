<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>vue3+vite+ts实现springboot项目前后端联调</title>
      <link href="/2024/08/19/front-backend-badminton/"/>
      <url>/2024/08/19/front-backend-badminton/</url>
      
        <content type="html"><![CDATA[<p>​<br>引言：<br>实现了基于springboot的球场预约管理系统的后端代码后，准备实现前端简单的登录和跳转功能。</p><p>一：创建前端项目<br>使用create-vue官方脚手架搭建项目</p><p>在终端输入</p><p>npm create vue@latest<br>命名项目名Badminton-front-demo</p><p>创建好后,按照给出的命令一个个运行</p><p>cd Badminton-front-demo<br>npm install<br>npm run dev</p><p>若担心路径输错或太长麻烦，可以用键盘上的tab键补全路径</p><p>打开给出的网址 <a href="http://localhost:5173/">http://localhost:5173/</a></p><p>这里可以自己设置端口号和是否自动打开网址:在根目录下找到vite.config.ts更改，具体配置问题在这儿</p><p>成功运行后的网页如下</p><p>二：修改代码<br>项目根目录下找到components和views文件夹，将里面vue文件删除，然后找到App.vue，将template中的内容删除，删掉import爆红的一行代码。完成后，开始设计自己的页面</p><p>（1）登录页：<br>在views文件夹下创建LoginView.vue</p><p>这里原本是使用的element Plus，后来发现有个开源框架的登录也还可以，就copy了过来</p><template>    <div class="login-wrap">      <div class="login-root">        <div class="login-main">          <img class="login-one-ball"            src="https://assets.codehub.cn/micro-frontend/login/fca1d5960ccf0dfc8e32719d8a1d80d2.png" />          <img class="login-two-ball"            src="https://assets.codehub.cn/micro-frontend/login/4bcf705dad662b33a4fc24aaa67f6234.png" />          <div class="login-container">            <div class="login-side">              <div class="login-bg-title">                <h1>XXX羽毛球场预约管理</h1><pre><code>            &lt;h3 style=&quot;margin: 20px auto&quot;&gt;              Welcome to XXX            &lt;/h3&gt;          &lt;/div&gt;        &lt;/div&gt;        &lt;div class=&quot;login-ID&quot;&gt;          &lt;div style=&quot;font-size: 22px; margin-bottom: 15px; margin-top: 5px&quot;&gt;            🎯 Sign in          &lt;/div&gt;  &lt;el-form :model=&quot;form&quot; label-width=&quot;auto&quot; style=&quot;max-width: 600px&quot; class=&quot;former&quot;&gt;  &lt;el-form-item label=&quot;账号&quot;&gt;    &lt;el-input v-model=&quot;form.adminName&quot; /&gt;  &lt;/el-form-item&gt;  &lt;el-form-item label=&quot;密码&quot;&gt;    &lt;el-input v-model=&quot;form.adminPassword&quot; type=&quot;password&quot; /&gt;  &lt;/el-form-item&gt;    &lt;el-form-item label=&quot;&quot;&gt;    &lt;el-button type=&quot;primary&quot; @click=&quot;onSubmit&quot;&gt;登录&lt;/el-button&gt;    &lt;el-button&gt;取消&lt;/el-button&gt;  &lt;/el-form-item&gt;&lt;/el-form&gt;          &lt;lay-line class=&quot;text-position&quot; style=&quot;margin: 34px 0px;&quot;&gt;Other login methods&lt;/lay-line&gt;          &lt;ul class=&quot;other-ways&quot;&gt;            &lt;li&gt;              &lt;div class=&quot;line-container&quot;&gt;                                &lt;p class=&quot;text&quot;&gt;微信&lt;/p&gt;              &lt;/div&gt;            &lt;/li&gt;            &lt;li&gt;              &lt;div class=&quot;line-container&quot;&gt;                                &lt;p class=&quot;text&quot;&gt;钉钉&lt;/p&gt;              &lt;/div&gt;            &lt;/li&gt;            &lt;li&gt;              &lt;div class=&quot;line-container&quot;&gt;                                &lt;p class=&quot;text&quot;&gt;Gitee&lt;/p&gt;              &lt;/div&gt;            &lt;/li&gt;            &lt;li&gt;              &lt;div class=&quot;line-container&quot;&gt;                            &lt;p class=&quot;text&quot;&gt;Github&lt;/p&gt;              &lt;/div&gt;            &lt;/li&gt;          &lt;/ul&gt;        &lt;/div&gt;      &lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;</code></pre>  </template>  <style scoped>.login-captach {  display: inline-block;  vertical-align: bottom;  width: 108px;  height: 40px;  color: var(--global-primary-color);  margin-left: 8px;  border-radius: 4px;  border: 1px solid hsla(0, 0%, 60%, 0.46);  transition: border 0.2s;  box-sizing: border-box;  background: #fff;  overflow: hidden;  cursor: pointer;}<p>.login-one-ball {<br>opacity: 0.4;<br>position: absolute;<br>max-width: 568px;<br>left: -400px;<br>bottom: 0px;<br>}</p><p>.login-two-ball {<br>opacity: 0.4;<br>position: absolute;<br>max-width: 320px;<br>right: -200px;<br>top: -60px;<br>}</p><p>.login-wrap {<br>position: fixed;<br>top: 0;<br>left: 0;<br>bottom: 0;<br>right: 0;<br>overflow: auto;<br>min-width: 600px;<br>z-index: 9;<br>background-image: url(<a href="https://sky-take-out-super-fish.oss-cn-beijing.aliyuncs.com/tuchuang/202408161602507.png">https://sky-take-out-super-fish.oss-cn-beijing.aliyuncs.com/tuchuang/202408161602507.png</a>);<br>background-repeat: no-repeat;<br>background-size: cover;<br>min-height: 100vh;<br>}</p><p>.login-wrap :deep(.layui-input-block) {<br>margin-left: 0 !important;<br>}</p><p>.login-root {<br>position: absolute;<br>top: 50%;<br>left: 50%;<br>transform: translate(-50%, -50%);<br>display: flex;<br>justify-content: center;<br>width: 100%;<br>min-width: 320px;<br>background-color: initial;<br>}</p><p>.login-main {<br>position: relative;<br>display: block;<br>}</p><p>.logo-container {<br>max-width: calc(100vw - 28px);<br>margin-bottom: 40px;<br>text-align: center;<br>display: flex;<br>align-items: center;<br>justify-content: center;<br>}</p><p>.logo-container .logo {<br>display: inline-block;<br>height: 30px;<br>width: 143px;<br>background: url() no-repeat 50%;<br>background-size: contain;<br>cursor: pointer;<br>}</p><p>.login-container {<br>position: relative;<br>overflow: hidden;<br>width: 940px;<br>height: 540px;<br>max-width: calc(100vw - 28px);<br>border-radius: 4px;<br>background: hsla(0, 0%, 100%, 0.5);<br>backdrop-filter: blur(30px);<br>display: flex;<br>box-shadow: 6px 6px 12px 4px rgba(0, 0, 0, 0.1);<br>}</p><p>.login-side {<br>padding: 40px 20px 20px;<br>background-color: var(–global-primary-color);<br>flex: 1;<br>height: 100%;<br>}</p><p>.login-bg-title {<br>flex: 1;<br>background-image: url(‘<a href="https://sky-take-out-super-fish.oss-cn-beijing.aliyuncs.com/tuchuang/202408161602507.png">https://sky-take-out-super-fish.oss-cn-beijing.aliyuncs.com/tuchuang/202408161602507.png</a>‘);<br>height: 84%;<br>color: #000000;<br>text-align: center;<br>background-repeat: no-repeat;<br>background-position: bottom;<br>background-size: contain;<br>text-align: center;<br>min-width: 200px;<br>z-index: 1;<br>}</p><p>.login-ID {<br>padding: 20px 30px;<br>min-width: 420px;<br>}</p><p>.login-container .layui-tab-head {<br>background: transparent;<br>}</p><p>.login-container .layui-input-wrapper {<br>margin-top: 10px;<br>margin-bottom: 10px;<br>}</p><p>.login-container .layui-input-wrapper {<br>margin-top: 12px;<br>margin-bottom: 12px;<br>}</p><p>.login-container .assist {<br>margin-top: 5px;<br>margin-bottom: 5px;<br>letter-spacing: 2px;<br>}</p><p>.login-container .layui-btn {<br>margin: 10px 0px 10px 0px;<br>letter-spacing: 2px;<br>height: 40px;<br>}</p><p>.login-container .layui-line-horizontal {<br>letter-spacing: 2px;<br>margin-bottom: 34px;<br>margin-top: 24px;<br>}</p><p>.other-ways {<br>display: flex;<br>justify-content: space-between;<br>margin: 0;<br>padding: 0;<br>list-style: none;<br>font-size: 14px;<br>font-weight: 400;<br>}<br>.text-position {<br>position: relative;<br>top: 140px;<br>}<br>.other-ways li {<br>width: 100%;<br>}</p><p>.line-container {<br>position: relative;<br>top: 150px;<br>text-align: center;<br>cursor: pointer;<br>}</p><p>.line-container .icon {<br>height: 28px;<br>width: 28px;<br>margin-right: 0;<br>vertical-align: middle;<br>border-radius: 50%;<br>background: #fff;<br>box-shadow: 0 1px 2px 0 rgb(9 30 66 &#x2F; 4%), 0 1px 4px 0 rgb(9 30 66 &#x2F; 10%),<br>0 0 1px 0 rgb(9 30 66 &#x2F; 10%);<br>}</p><p>.line-container .text {<br>display: block;<br>margin: 12px 0 0;<br>font-size: 12px;<br>color: #8592a6;<br>}</p><p>:deep(.layui-tab-title .layui-this) {<br>background-color: transparent;<br>}<br>.former {<br>position: relative;<br>top: 20%;<br>}<br></style></p><script lang="ts" setup>  import { useRouter } from 'vue-router';import { reactive, ref } from 'vue'import axios from 'axios';    // do not use same name with ref  const form = ref({    adminName: '',    adminPassword: '',  })  const adminDto = {    adminName: form.value.adminName,    adminPassword: form.value.adminPassword,  };  const route=useRouter()  const onSubmit =async () => {    if (form.value.adminName === 'root' && form.value.adminPassword === '123456')     {      try{        const response =await axios.post("http://localhost:8080/admin/login",form.value,{          headers: {            'Content-Type': 'application/json',          },        });        console.log(adminDto);        console.log(form.value);        console.log(response.data);        handleResponse(response.data);        if (response.data.code === 0) {          route.replace('/home');        } else {          alert('登录失败，请检查用户名和密码是否正确');        }              } catch (error) {        if (axios.isAxiosError(error)) {    if (error.response) {      // The request was made and the server responded with a status code      // that falls out of the range of 2xx      console.error('Error response:', error.response.data);      alert('登录失败，请检查用户名和密码是否正确');    } else if (error.request) {      // The request was made but no response was received      console.error('No response received:', error.request);      alert('无法连接到服务器，请检查网络连接');    } else {      // Something happened in setting up the request that triggered an Error      console.error('Error setting up request:', error.message);      alert('发生未知错误，请稍后再试');    }  } else {    console.error('Unknown error:', error);    alert('发生未知错误，请稍后再试');  }      }  } else {    alert('请输入用户名和密码');  }  console.log('Submitted');  console.log(route);  };  // 设置 Axios 拦截器axios.interceptors.request.use(function (config) {  const token = localStorage.getItem('token');  if (token) {    config.headers.Authorization = `Bearer ${token}`;  }  return config;}, function (error) {  return Promise.reject(error);});  const handleResponse = (data: ResponseData) =>{    console.log('Response data',data);    if (data.code === 0) {      alert('登录成功');    } else {      alert('登录失败');    }  };  interface ResponseData {    code: number;    message: string;    data: any;  }  </script><p>修改添加后就成了以上代码,其中的图片url换成了我个人的阿里云图床，删除了目前不必要的功能后，运行界面如下</p><p>登录成功后要进入首页面，因此接下来创建首页，同样在views文件夹下创建Main.vue</p><p>（2）首页：<br>首页则使用了Element plus的布局容器</p><script lang="ts" setup>import CommonAside from "../components/CommonAside.vue"import CommonSub from "../components/CommonSub.vue";import CommonMain from "../components/CommonMain.vue";import Booking from "../components/booking/Booking.vue"import { ref } from "vue";</script><template>    <div class="common-layout">      <el-container>        <el-aside width="200px"><common-aside/></el-aside>        <el-container>          <el-header><common-sub></common-sub></el-header>          <el-main>          <common-main></common-main>          </el-main>        </el-container>      </el-container>    </div>  </template>  <style lang="less" scoped>.common-layout {    height: 100%;    &>.el-container {        height: 100%;        &>.el-aside {            height: 100%;            width: 10%;            background: #CDD0D6;        }        &>.el-container {            &>.el-header {                background-color: #D4D7DE;                padding: 0%;            }            &>.el-container{              &>.el-main {                height: 100%;                background-color: #DCDFE6;              }            }        }    }}</style><p>其中CommonAside，CommonSub,CommonMain是顶栏，边栏和主要内容相关的页面。由import引入在标签中使用，配置css格式使得容器格式合理。接下来编辑这三个组件</p><p>（3）边栏：<br>在components下创建CommonAside.vue,同样使用Element Plus</p><template>    <el-row class="tac">      <el-col :span="25">        <h5 class="mb-2"></h5>        <el-menu          default-active="2"          class="el-menu-vertical-demo"          @open="handleOpen"          @close="handleClose"          background-color="#CDD0D6"        >          <el-sub-menu index="1">            <template #title>              <el-icon><location /></el-icon>              <span>首页</span>            </template>            <el-menu-item-group title="预约相关">              <el-menu-item index="1-1" @click="ToBooking">预约</el-menu-item>              <el-menu-item index="1-2">查看预约</el-menu-item>            </el-menu-item-group>            <el-menu-item-group title="账号相关">              <el-menu-item index="1-3">我的</el-menu-item>            </el-menu-item-group>            <el-sub-menu index="1-4">              <template #title>关于</template>              <el-menu-item index="1-4-1">作者</el-menu-item>              <el-menu-item index="1-4-2">支持</el-menu-item>            </el-sub-menu>          </el-sub-menu>          <el-menu-item index="2" @click="handleClick">            <el-icon><icon-menu /></el-icon>            <span>返回首页</span>          </el-menu-item>        </el-menu>      </el-col>    </el-row>  </template>  <script lang="ts" setup>  import { useRouter } from 'vue-router';const router=useRouter()import {    Document,    Menu as IconMenu,    Location,    Setting,  } from '@element-plus/icons-vue'  const handleOpen = (key: string, keyPath: string[]) => {    console.log(key, keyPath)  }  const handleClose = (key: string, keyPath: string[]) => {    console.log(key, keyPath)  }  const handleClick = () => {    router.replace('/')  }function ToBooking(){router.push({  path:'/reservation'})  }  </script><p>（4）顶栏：<br><template><br>&lt;el-menu<br>:default-active&#x3D;”activeIndex”<br>class&#x3D;”el-menu-demo”<br>mode&#x3D;”horizontal”<br>@select&#x3D;”handleSelect”<br>background-color&#x3D;”#D4D7DE”</p><blockquote></blockquote><p><el-menu-item index="1">Processing Center</el-menu-item><br><el-sub-menu index="2"><br>&lt;template #title&gt;Workspace</template><br><el-menu-item index="2-1">item one</el-menu-item><br><el-menu-item index="2-2">item two</el-menu-item><br><el-menu-item index="2-3">item three</el-menu-item><br><el-sub-menu index="2-4"><br>&lt;template #title&gt;item four</template><br><el-menu-item index="2-4-1">item one</el-menu-item><br><el-menu-item index="2-4-2">item two</el-menu-item><br><el-menu-item index="2-4-3">item three</el-menu-item><br></el-sub-menu><br></el-sub-menu><br><el-menu-item index="3" disabled>Info</el-menu-item><br><el-menu-item index="4">Orders</el-menu-item><br></el-menu></p><div class="h-6" /><!-- <el-menu  :default-active="activeIndex2"  class="el-menu-demo"  mode="horizontal"  background-color="#545c64"  text-color="#fff"  active-text-color="#ffd04b"  @select="handleSelect">  <el-menu-item index="1">Processing Center</el-menu-item>  <el-sub-menu index="2">    <template #title>Workspace</template>    <el-menu-item index="2-1">item one</el-menu-item>    <el-menu-item index="2-2">item two</el-menu-item>    <el-menu-item index="2-3">item three</el-menu-item>    <el-sub-menu index="2-4">      <template #title>item four</template>      <el-menu-item index="2-4-1">item one</el-menu-item>      <el-menu-item index="2-4-2">item two</el-menu-item>      <el-menu-item index="2-4-3">item three</el-menu-item>    </el-sub-menu>  </el-sub-menu>  <el-menu-item index="3" disabled>Info</el-menu-item>  <el-menu-item index="4">Orders</el-menu-item></el-menu> --></template>  <script lang="ts" setup>  import { ref } from 'vue'    const activeIndex = ref('1')  const activeIndex2 = ref('1')  const handleSelect = (key: string, keyPath: string[]) => {    console.log(key, keyPath)  }  </script><p>（5）主要内容：<br><template><br>&lt;el-menu<br>:default-active&#x3D;”activeIndex”<br>class&#x3D;”el-menu-demo”<br>mode&#x3D;”horizontal”<br>@select&#x3D;”handleSelect”<br>background-color&#x3D;”#D4D7DE”</p><blockquote></blockquote><p><el-menu-item index="1">Processing Center</el-menu-item><br><el-sub-menu index="2"><br>&lt;template #title&gt;Workspace</template><br><el-menu-item index="2-1">item one</el-menu-item><br><el-menu-item index="2-2">item two</el-menu-item><br><el-menu-item index="2-3">item three</el-menu-item><br><el-sub-menu index="2-4"><br>&lt;template #title&gt;item four</template><br><el-menu-item index="2-4-1">item one</el-menu-item><br><el-menu-item index="2-4-2">item two</el-menu-item><br><el-menu-item index="2-4-3">item three</el-menu-item><br></el-sub-menu><br></el-sub-menu><br><el-menu-item index="3" disabled>Info</el-menu-item><br><el-menu-item index="4">Orders</el-menu-item><br></el-menu></p><div class="h-6" /><!-- <el-menu  :default-active="activeIndex2"  class="el-menu-demo"  mode="horizontal"  background-color="#545c64"  text-color="#fff"  active-text-color="#ffd04b"  @select="handleSelect">  <el-menu-item index="1">Processing Center</el-menu-item>  <el-sub-menu index="2">    <template #title>Workspace</template>    <el-menu-item index="2-1">item one</el-menu-item>    <el-menu-item index="2-2">item two</el-menu-item>    <el-menu-item index="2-3">item three</el-menu-item>    <el-sub-menu index="2-4">      <template #title>item four</template>      <el-menu-item index="2-4-1">item one</el-menu-item>      <el-menu-item index="2-4-2">item two</el-menu-item>      <el-menu-item index="2-4-3">item three</el-menu-item>    </el-sub-menu>  </el-sub-menu>  <el-menu-item index="3" disabled>Info</el-menu-item>  <el-menu-item index="4">Orders</el-menu-item></el-menu> --></template>  <script lang="ts" setup>  import { ref } from 'vue'    const activeIndex = ref('1')  const activeIndex2 = ref('1')  const handleSelect = (key: string, keyPath: string[]) => {    console.log(key, keyPath)  }  </script><p>三：路由注册<br>进入到router&#x2F;index.ts下编辑，为几个页面注册路由</p><p>import { createRouter, createWebHistory } from ‘vue-router’</p><p>import home from ‘..&#x2F;views&#x2F;Main.vue’<br>import login from ‘..&#x2F;views&#x2F;LoginView.vue’<br>import copy from ‘..&#x2F;views&#x2F;LoginCopyView.vue’<br>import book from ‘..&#x2F;components&#x2F;booking&#x2F;Booking.vue’<br>import reservation from ‘..&#x2F;views&#x2F;Reservation.vue’<br>const router &#x3D; createRouter({<br>history: createWebHistory(import.meta.env.BASE_URL),<br>routes: [<br>{<br>path: ‘&#x2F;‘,<br>name: ‘login’,<br>component: copy<br>},<br>{<br>path: ‘&#x2F;home’,<br>name: ‘home’,<br>component: home<br>},<br>{<br>path: ‘&#x2F;booking’,<br>name: ‘booking’,<br>component: book<br>},<br>{<br>path: ‘&#x2F;reservation’,<br>name: ‘reservation’,<br>component: reservation<br>}<br>]<br>})</p><p>export default router</p><p>随后在App.vue下引入路由</p><script setup lang="ts">import { RouterLink, RouterView } from 'vue-router'</script><template><RouterView></RouterView></template><style scoped></style><p>四：前后端联调<br>实现管理员登录功能</p><p>后端代码接受的是JSON格式数据adminName,adminPassword，因此前端也传入JSON数据:name,password</p><p>因为遇到了后端接受不到数据的情况，所以做了些小改动</p><p>定义一个结构form，里面包含adminName，adminPassword</p><p>const form &#x3D; ref({<br>adminName: ‘’,<br>adminPassword: ‘’,<br>})</p><p>手动设置数据格式，代码如下</p><script lang="ts" setup>  import { useRouter } from 'vue-router';import { reactive, ref } from 'vue'import axios from 'axios';    // do not use same name with ref  const form = ref({    adminName: '',    adminPassword: '',  })  const adminDto = {    adminName: form.value.adminName,    adminPassword: form.value.adminPassword,  };  const route=useRouter()  const onSubmit =async () => {    if (form.value.adminName === 'root' && form.value.adminPassword === '123456')     {      try{        const response =await axios.post("http://localhost:8080/admin/login",form.value,{          headers: {            'Content-Type': 'application/json',          },        });        console.log(adminDto);        console.log(form.value);        console.log(response.data);        handleResponse(response.data);        if (response.data.code === 0) {          route.replace('/home');        } else {          alert('登录失败，请检查用户名和密码是否正确');        }              } catch (error) {        if (axios.isAxiosError(error)) {    if (error.response) {      // The request was made and the server responded with a status code      // that falls out of the range of 2xx      console.error('Error response:', error.response.data);      alert('登录失败，请检查用户名和密码是否正确');    } else if (error.request) {      // The request was made but no response was received      console.error('No response received:', error.request);      alert('无法连接到服务器，请检查网络连接');    } else {      // Something happened in setting up the request that triggered an Error      console.error('Error setting up request:', error.message);      alert('发生未知错误，请稍后再试');    }  } else {    console.error('Unknown error:', error);    alert('发生未知错误，请稍后再试');  }      }  } else {    alert('请输入用户名和密码');  }  console.log('Submitted');  console.log(route);};增加了多个验证和日志输出便于找到错误，随后添加axios拦截器// 设置 Axios 拦截器axios.interceptors.request.use(function (config) {  const token = localStorage.getItem('token');  if (token) {    config.headers.Authorization = `Bearer ${token}`;  }  return config;}, function (error) {  return Promise.reject(error);});  const handleResponse = (data: ResponseData) =>{    console.log('Response data',data);    if (data.code === 0) {      alert('登录成功');    } else {      alert('登录失败');    }  };  interface ResponseData {    code: number;    message: string;    data: any;  }运行后端代码前端页面点击登录按钮点击确定后跳转到首页成功登录​]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vite </tag>
            
            <tag> 前后端联调 </tag>
            
            <tag> vue-router </tag>
            
            <tag> Typescript </tag>
            
            <tag> Element-plus </tag>
            
            <tag> Axios </tag>
            
            <tag> 路由跳转 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoFrame新手实战(五)</title>
      <link href="/2024/08/13/goframe-xin-shou-shi-zhan-wu/"/>
      <url>/2024/08/13/goframe-xin-shou-shi-zhan-wu/</url>
      
        <content type="html"><![CDATA[<h3 id="引言："><a href="#引言：" class="headerlink" title="引言："></a>引言：</h3><p>本次主要实现分页查询功能，因昨天写这个功能时遇到了困难，因此放到今天好好研究一下。</p><hr><p>首先，官方文档中的orm是有对分页查询操作的。只不过要用到链式操作，因此先学习一下链式操作。</p><h3 id="模型创建"><a href="#模型创建" class="headerlink" title="模型创建"></a>模型创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g.Model(&quot;article&quot;)</span><br><span class="line">m:=g.Model(&quot;article&quot;)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>这里涉及到一个概念，叫链式安全</p><p>文档中对链式安全的定义是这样的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">链式安全只是模型操作的两种方式区别：一种会修改当前model对象（不安全，默认），一种不会（安全）但是模型属性修改/条件叠加需要使用赋值操作，仅此而已。</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>使用gf gen dao产生的dao对象默认是链式安全的，因此这里不多赘述，想了解的可以<a href="https://goframe.org/pages/viewpage.action?pageId=1114699">看这里</a>。</p><p>接下来是查询操作</p><h3 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h3><p>先从简单的where学起：</p><p>where+string，条件参数使用字符串和预处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 查询多条记录并使用Limit分页</span><br><span class="line">// SELECT * FROM user WHERE uid&gt;1 LIMIT 0,10</span><br><span class="line">g.Model(&quot;user&quot;).Where(&quot;uid &gt; ?&quot;, 1).Limit(0, 10).All()</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>用ScanAndCount实现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// GetList 获取实例的用户列表.</span><br><span class="line">func (s sUserInfo) GetList(ctx context.Context, in model.UserInfoGetListInput) (items []entity.UserInfo, total int, err error) &#123;</span><br><span class="line">items = make([]entity.UserInfo, 0)</span><br><span class="line">err = dao.UserInfo.Ctx(ctx).OmitEmpty().</span><br><span class="line">Where(do.UserInfo&#123;</span><br><span class="line">ResourceId: in.ResourceId,</span><br><span class="line">Status:     in.Statuses,</span><br><span class="line">&#125;).</span><br><span class="line">Order(in.OrderBy, in.OrderDirection).</span><br><span class="line">Limit(in.Offset, in.Limit).</span><br><span class="line">ScanAndCount(&amp;items, &amp;total, true)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>然而官方文档中貌似只有这个业务逻辑实现的代码</p><p>其中的Order和Limit都是现在不需要的，所以直接删了就行，将里面的部分内容换成自己项目的数据，修改后的代码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func (s sArticle) GetList(ctx context.Context, in model.ArticleGetListInput) (items []entity.Article, size int, err error) &#123;</span><br><span class="line">items = make([]entity.Article, 0)</span><br><span class="line">size = in.Size</span><br><span class="line">err = dao.Article.Ctx(ctx).OmitEmpty().</span><br><span class="line">Where(&quot;delete_time is null&quot;).</span><br><span class="line">ScanAndCount(&amp;items, &amp;size, true)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>之后修改api中对应的文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ArticleGetListReq <span class="keyword">struct</span> &#123;</span><br><span class="line">g.Meta <span class="string">`path:&quot;/article/get-list&quot; tags:&quot;Article&quot; method:&quot;get&quot; summary:&quot;获取文章列表&quot;`</span></span><br><span class="line">Page   <span class="type">int</span> <span class="string">`p:&quot;page&quot; v:&quot;min:0#请输入正确的页数&quot; dc:&quot;页数&quot;`</span></span><br><span class="line">Size   <span class="type">int</span> <span class="string">`p:&quot;size&quot; v:&quot;min:1#请输入正确的页数&quot; dc:&quot;页数&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> ArticleGetListRes <span class="keyword">struct</span> &#123;</span><br><span class="line">List []entity.Article <span class="string">`json:&quot;list&quot;`</span></span><br><span class="line">Size <span class="type">int</span></span><br><span class="line">Page <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>再去修改控制层对应的文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ControllerV1)</span></span> ArticleGetList(ctx context.Context, req *v1.ArticleGetListReq) (res *v1.ArticleGetListRes, err <span class="type">error</span>) &#123;</span><br><span class="line">res = &amp;v1.ArticleGetListRes&#123;&#125;</span><br><span class="line">res.List, res.Size, err = service.Article().GetList(ctx, model.ArticleGetListInput&#123;</span><br><span class="line">Page: req.Page,</span><br><span class="line">        Size: req.Size</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>在修改调试该文件的内容时，遇到了空指针的问题，百度之后加上了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = &amp;v1.ArticleGetListRes&#123;&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>这句<br> 语句的作用是显式初始化res为&amp;v1.ArticleGetListRes{}。这样即使service.Article().GetList方法失败，也不会因为尝试解引用nil指针而引发运行时错误。</p><p>最后改一下model中的结构体</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ArticleGetListInput <span class="keyword">struct</span> &#123;</span><br><span class="line">Page <span class="type">int</span></span><br><span class="line">Size <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行测试一下看看</p><p><img src="https://i-blog.csdnimg.cn/direct/112a7821d9fd43628bb7f76241a7e7cc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>虽然好像还有点小问题，但是能跑就行，之后的学习总能解决的</p><hr><p>这样一来crud就大致上完成了一遍<br>可惜的是，通过后来对博客框架的学习，发现搭建博客甚至不需要后端编写代码</p>]]></content>
      
      
      <categories>
          
          <category> GoFrame学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 分页查询 </tag>
            
            <tag> GoFrame </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoFrame新手实战(四)</title>
      <link href="/2024/08/13/goframe-xin-shou-shi-zhan-si/"/>
      <url>/2024/08/13/goframe-xin-shou-shi-zhan-si/</url>
      
        <content type="html"><![CDATA[<h4 id="引言："><a href="#引言：" class="headerlink" title="引言："></a>引言：</h4><p>在完成了对管理员登录功能的简单实现后，接下来围绕文章和标签两张表的crud进行操作。</p><hr><h3 id="一：文章表的crud"><a href="#一：文章表的crud" class="headerlink" title="一：文章表的crud"></a>一：文章表的crud</h3><h4 id="首先完善新增文章操作"><a href="#首先完善新增文章操作" class="headerlink" title="首先完善新增文章操作"></a>首先完善新增文章操作</h4><h5 id="controller层"><a href="#controller层" class="headerlink" title="controller层"></a>controller层</h5><p>仿照参考文档中的代码，为&#x2F;controller&#x2F;article&#x2F;article_v1_article_create.go编写代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func (c *ControllerV1) ArticleCreate(ctx context.Context, req *v1.ArticleCreateReq) (res *v1.ArticleCreateRes, err error) &#123;</span><br><span class="line">err = service.Article().Create(ctx, model.ArticleCreateInput&#123;</span><br><span class="line">Content:  req.Content,</span><br><span class="line">Layout:   req.Layout,</span><br><span class="line">PostName: req.PostName,</span><br><span class="line">Tags:     req.Tags,</span><br><span class="line">Title:    req.Title,</span><br><span class="line">TagsId:   req.TagsId,</span><br><span class="line">&#125;)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>解决报红的三个地方，在model层中创建article.go,定义ArticleCreateInput结构体,目的是为了定义统一的入参结构，具体如何理解个人参考的是这篇文章<a href="https://xie.infoq.cn/article/e09ad866d8386f1e052fcf637">GoFrame V2真香，我是Get到了高内聚低耦合的点，你呢？_Go_王中阳Go_InfoQ写作社区</a></p><p>ArticleCreateInput如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type ArticleCreateInput struct &#123;</span><br><span class="line">Content  string</span><br><span class="line">Layout   string</span><br><span class="line">PostName string</span><br><span class="line">Tags     string</span><br><span class="line">Title    string</span><br><span class="line">Post     int</span><br><span class="line">TagsId   string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>接下来因为要使用logic来生成service接口，所以先编写logic层的代码</p><h5 id="logic层"><a href="#logic层" class="headerlink" title="logic层"></a>logic层</h5><p>在&#x2F;logic&#x2F;article下创建article.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> (</span><br><span class="line">sArticle <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">service.RegisterArticle(New())</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span></span> service.IArticle &#123; <span class="keyword">return</span> &amp;sArticle&#123;&#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sArticle)</span></span> Create(ctx context.Context, in model.ArticleCreateInput) (err <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> in.Title == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> in.Content == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dao.Article.Transaction(ctx, <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, tx gdb.TX)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">_, err := dao.Article.Ctx(ctx).Data(do.Article&#123;</span><br><span class="line">Content:  in.Content,</span><br><span class="line">Layout:   in.Layout,</span><br><span class="line">Post:     in.Post,</span><br><span class="line">PostName: in.PostName,</span><br><span class="line">TagsId:   in.TagsId,</span><br><span class="line">Title:    in.Title,</span><br><span class="line">&#125;).Insert()</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>由于我goLand配置了官方给的自动配置<a href="https://goframe.org/pages/viewpage.action?pageId=49770772">模块规范-gen service - GoFrame (ZH)-Latest - GoFrame官网 - 类似PHP-Laravel, Java-SpringBoot的Go企业级开发框架</a></p><p>因此编写完成后无需手动输入gf gen service。</p><p>后来在测试前发现了数据库的create_time和update_time自己设置了不能为空，于是在插入语句中新增两句</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">         CreateTime: gtime.New(time.Now()),</span><br><span class="line">UpdateTime: gtime.New(time.Now()),</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://i-blog.csdnimg.cn/direct/07e11448f54f4b51aa93bac0fe9e9027.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑<img src="https://i-blog.csdnimg.cn/direct/58ba7f3093a14deaa4f5e026ef84d684.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>检查数据库，数据库中也成功插入数据</p><p><img src="https://i-blog.csdnimg.cn/direct/8194861272604a00a10d736407ba7c87.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>这样一个基本的新增操作就完成了</p><h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><p>这里采用逻辑删除，也就是软删除，所以本质上也就是update。以deleteTime是否为空作为判断是否删除的标准.</p><p>步骤和上面的操作一样</p><h5 id="先检查api接口"><a href="#先检查api接口" class="headerlink" title="先检查api接口"></a>先检查api接口</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gogf/gf/v2/frame/g&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ArticleDeleteReq <span class="keyword">struct</span> &#123;</span><br><span class="line">g.Meta <span class="string">`path:&quot;/article/delete&quot; tags:&quot;Article&quot; method:&quot;post&quot; summary:&quot;删除文章&quot;`</span></span><br><span class="line">Id     <span class="type">int</span> <span class="string">`p:&quot;id&quot; v:&quot;required#文章ID不能为空&quot; dc:&quot;文章ID&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> ArticleDeleteRes <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="然后在controller对应的包下编写代码"><a href="#然后在controller对应的包下编写代码" class="headerlink" title="然后在controller对应的包下编写代码"></a>然后在controller对应的包下编写代码</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> article</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;demo-blog/internal/model&quot;</span></span><br><span class="line"><span class="string">&quot;demo-blog/internal/service&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;demo-blog/api/article/v1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ControllerV1)</span></span> ArticleDelete(ctx context.Context, req *v1.ArticleDeleteReq) (res *v1.ArticleDeleteRes, err <span class="type">error</span>) &#123;</span><br><span class="line">err = service.Article().Delete(ctx, model.ArticleDeleteInput&#123;</span><br><span class="line">Id: req.Id,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="在model层创建ArticleDeleteInput结构体"><a href="#在model层创建ArticleDeleteInput结构体" class="headerlink" title="在model层创建ArticleDeleteInput结构体"></a>在model层创建ArticleDeleteInput结构体</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ArticleDeleteInput <span class="keyword">struct</span> &#123;</span><br><span class="line">Id <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="最后在logic层的article-article-go中编写"><a href="#最后在logic层的article-article-go中编写" class="headerlink" title="最后在logic层的article&#x2F;article.go中编写"></a>最后在logic层的article&#x2F;article.go中编写</h5><p>Transaction是添加事务管理</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sArticle)</span></span> Delete(ctx context.Context, in model.ArticleDeleteInput) (err <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> dao.Article.Transaction(ctx, <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, tx gdb.TX)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">_, err := dao.Article.Ctx(ctx).Where(<span class="string">&quot;id&quot;</span>, in.Id).Update(do.Article&#123;</span><br><span class="line">DeleteTime: gtime.New(time.Now()),<span class="comment">//为输入id对应的那条数据更新delete_time</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>在之后的所有查询里，都要添加上判断delete_time是否为空的条件。比较麻烦，但是goframe有解决的方案：<a href="https://goframe.org/pages/viewpage.action?pageId=1114139">ORM链式操作-时间维护 - GoFrame (ZH)-Latest - GoFrame官网 - 类似PHP-Laravel, Java-SpringBoot的Go企业级开发框架</a></p><p>只不过只能在它的链式操作中使用，并且数据库要包含create_at，update_at，delete_at任意或多个字段时才启用。</p><p>现在重新运行一下项目</p><h5 id="测试接口"><a href="#测试接口" class="headerlink" title="测试接口"></a>测试接口</h5><p><img src="https://i-blog.csdnimg.cn/direct/2c63e4df0d6747cc813adc746b08c509.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>别忘了在业务层或控制层对输入的内容进行判断，确保输入数据符合要求。</p><p><img src="https://i-blog.csdnimg.cn/direct/93eef86229434f86b622b64203c284dc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>可以看到成功的为这条字段更新了删除时间，删除操作也完成了。</p><h4 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h4><p>默认写分页查询。</p><p>分页查询可参考官方文档<a href="https://goframe.org/pages/viewpage.action?pageId=98984073">ORM查询-ScanAndCount - GoFrame (ZH)-Latest - GoFrame官网 - 类似PHP-Laravel, Java-SpringBoot的Go企业级开发框架</a></p><h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>api层用于处理接收的参数</p><p>​    model层用于控制传入的数据标准</p><p>​    controller层将得到的数据传入业务层</p><p>​    logic层处理具体的业务逻辑</p>]]></content>
      
      
      <categories>
          
          <category> GoFrame学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GoFrame </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoFrame新手实战(三)</title>
      <link href="/2024/08/13/goframe-xin-shou-shi-zhan-san/"/>
      <url>/2024/08/13/goframe-xin-shou-shi-zhan-san/</url>
      
        <content type="html"><![CDATA[<h4 id="编写controller层"><a href="#编写controller层" class="headerlink" title="编写controller层"></a>编写controller层</h4><p>参考官方示例项目的代码，例如登录操作：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (c *ControllerV1) SignIn(ctx context.Context, req *v1.SignInReq) (res *v1.SignInRes, err error) &#123;</span><br><span class="line">err = service.User().SignIn(ctx, model.UserSignInInput&#123;</span><br><span class="line">Passport: req.Passport,</span><br><span class="line">Password: req.Password,</span><br><span class="line">&#125;)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>仿照这个样式，在&#x2F;controller&#x2F;admin目录下创建admin_v1_sign_in.go文件。</p><p>填入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (c *ControllerV1) SignIn(ctx context.Context, req *v1.SignInReq) (res *v1.SignInRes, err error) &#123;</span><br><span class="line">err = service.Admin().SignIn(ctx, model.AdminSignInInput&#123;</span><br><span class="line">Name:     req.Name,</span><br><span class="line">Password: req.Password,</span><br><span class="line">&#125;)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>service爆红，由官方文档可知:</p><p>可以按照一定的编码规范，从<code>logic</code>业务逻辑代码生成<code>service</code>接口定义代码。因此先编写logic层的代码。此时查看示例项目，发现logic下有除了user的功能代码外，还有三个包</p><p><img src="https://i-blog.csdnimg.cn/direct/6382bea9442d46059bc45e0586f714f1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>由于不清楚具体作用，在项目中就不考虑添加，以实现基础功能为主。</p><h4 id="实现logic层业务逻辑"><a href="#实现logic层业务逻辑" class="headerlink" title="实现logic层业务逻辑"></a>实现logic层业务逻辑</h4><p>创建&#x2F;logic&#x2F;admin&#x2F;admin.go</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func init() &#123;</span><br><span class="line">service.RegisterAdmin(New())</span><br><span class="line">&#125;</span><br><span class="line">func New() service.IAdmin &#123; return &amp;sAdmin&#123;&#125; &#125;</span><br><span class="line">func (s *sAdmin) SignIn(ctx context.Context, in model.AdminSignInInput) (err error) &#123;</span><br><span class="line">var admin *entity.Admin</span><br><span class="line">err = dao.Admin.Ctx(ctx).Where(do.Admin&#123;</span><br><span class="line">Name:     in.Name,</span><br><span class="line">Password: in.Password,</span><br><span class="line">&#125;).Scan(&amp;admin)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">if admin == nil &#123;</span><br><span class="line">return gerror.New(`Passport or Password not correct`)</span><br><span class="line">&#125;</span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>model.AdminSignInInput会报错，因此需要在model目录下创建一个admin.go文件,定义这个结构体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package model</span><br><span class="line"></span><br><span class="line">type AdminSignInInput struct &#123;</span><br><span class="line">Name     string</span><br><span class="line">Password string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>全部编写完成后运行项目，为数据库添加admin数据，通过接口测试数据，发现报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. cannot find database driver for specified database type &quot;mysql&quot;, did you misspell type name &quot;mysql&quot; or forget importing the database driver? possible reference</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4 id="解决连接数据库报错"><a href="#解决连接数据库报错" class="headerlink" title="解决连接数据库报错"></a>解决连接数据库报错</h4><p>首先怀疑的是config中的数据库配置问题，检查一遍发现配置没问题。想不出还有什么地方出问题，于是复制了问题描述给ai和百度。先按照通义灵码给出的排查方案检查，仍然报同样的错误，最后上百度一查，发现第一条就匹配到了官方文档的常见问题。</p><p><img src="https://i-blog.csdnimg.cn/direct/981e91a61af5494ba457e645ca860a8d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>进入给出的地址，先安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gogf/gf/contrib/drivers/mysql/v2</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>然后在main.go中引入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import _ &quot;github.com/gogf/gf/contrib/drivers/mysql/v2&quot;</span><br></pre></td></tr></table></figure><p>再测试一下接口遍，问题解决。原来是没有映入社区驱动导致的。</p><p>管理员的登录功能就算是告一段落，接下来开始编写其余功能。</p>]]></content>
      
      
      <categories>
          
          <category> GoFrame学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GoFrame </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoFrame新手实战(二)</title>
      <link href="/2024/08/13/goframe-xin-shou-shi-zhan-er/"/>
      <url>/2024/08/13/goframe-xin-shou-shi-zhan-er/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言:"></a>引言:</h2><p>接着上一篇，这一篇记录个人实现博客小项目第二天的实战过程。</p><hr><h4 id="二：编写代码"><a href="#二：编写代码" class="headerlink" title="二：编写代码"></a>二：编写代码</h4><p>输入<code>gf gen dao</code>，若数据库连接无误，则会根据连接数据库的表生成对应的go文件，例如：</p><p>admin.go</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// =================================================================================</span><br><span class="line">// This is auto-generated by GoFrame CLI tool only once. Fill this file as you wish.</span><br><span class="line">// =================================================================================</span><br><span class="line"></span><br><span class="line">package dao</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;demo-blog/internal/dao/internal&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// internalAdminDao is internal type for wrapping internal DAO implements.</span><br><span class="line">type internalAdminDao = *internal.AdminDao</span><br><span class="line"></span><br><span class="line">// adminDao is the data access object for table admin.</span><br><span class="line">// You can define custom methods on it to extend its functionality as you wish.</span><br><span class="line">type adminDao struct &#123;</span><br><span class="line">internalAdminDao</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">// Admin is globally public accessible object for table admin operations.</span><br><span class="line">Admin = adminDao&#123;</span><br><span class="line">internal.NewAdminDao(),</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Fill with you ideas below.</span><br></pre></td></tr></table></figure><p><strong>接下来实现api层</strong></p><p>在官方文档中对api层代码编写的规范如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">前置约定</span><br><span class="line">重要的规范🔥</span><br><span class="line">该命令的目的之一是规范化api代码的编写，那么我们应该有一些重要的规范需要了解（否则生成不了代码哦）：</span><br><span class="line"></span><br><span class="line">api层的接口定义文件路径需要满足/api/模块/版本/定义文件.go，例如：/api/user/v1/user.go、/api/user/v1/user_delete.go、etc.</span><br><span class="line">这里的模块指的是API的模块划分，我们可以将API按照不同的业务属性进行拆分方便聚合维护。你也可以将模块认为是具体的业务资源。</span><br><span class="line">这里的版本通常使用v1/v2..这样的形式来定义，用以API兼容性的版本控制。当相同的API出现兼容性更新时，需要通过不同版本号来区分。默认使用v1来管理第一个版本。</span><br><span class="line">这里的定义文件指的是API的输入输出定义文件，通常每个API需要单独定义一个go文件来独立维护。当然也支持将多个API放到一个go文件中统一维护。</span><br><span class="line">api定义的结构体名称需要满足操作+Req及操作+Res的命名方式。例如：GetOneReq/GetOneRes、GetListReq/GetListRes、DeleteReq/DeleteRes、etc.</span><br><span class="line">这里的操作是当前API模块的操作名称，通常对应CURD是：Create、Update、GetList/GetOne、Delete。</span><br></pre></td></tr></table></figure><p> 模仿官方的写法,在api包下分别创建admin，article，tags包，例如: &#x2F;api&#x2F;admin&#x2F;v1&#x2F;</p><p><img src="https://i-blog.csdnimg.cn/direct/5ce665c58b6e45a18c8c1f105c891858.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>更具体的代码可以参考官方文档给出的示例项目：<a href="https://github.com/gogf/gf-demo-user">GitHub - gogf&#x2F;gf-demo-user: A simple user API service.</a></p><h5 id="官方示例项目下载："><a href="#官方示例项目下载：" class="headerlink" title="官方示例项目下载："></a>官方示例项目下载：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/gogf/gf-demo-user</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="使用gen命令生成代码"><a href="#使用gen命令生成代码" class="headerlink" title="使用gen命令生成代码"></a>使用gen命令生成代码</h5><p>按照官方文档的指示，在编写完api包下所需的代码后，在项目根目录执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gf gen ctrl</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>成功后controller包如下</p><p><img src="https://i-blog.csdnimg.cn/direct/cc0d516aee15400183ca1a994cf737fb.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">编辑</p><p>其中hello是用init创建项目时自动生成的示例代码，这里由于需要参考代码如何实现，并未删除</p><h5 id="在cmd中注册路由"><a href="#在cmd中注册路由" class="headerlink" title="在cmd中注册路由"></a>在cmd中注册路由</h5><p>​    这一部分由于个人不是很清楚原理，因此只得依样画葫芦，有错误的地方请指出。并留下todo待以后修改</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">Main = gcmd.Command&#123;</span><br><span class="line">Name:  <span class="string">&quot;main&quot;</span>,</span><br><span class="line">Usage: <span class="string">&quot;main&quot;</span>,</span><br><span class="line">Brief: <span class="string">&quot;start http server&quot;</span>,</span><br><span class="line">Func: <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, parser *gcmd.Parser)</span></span> (err <span class="type">error</span>) &#123;</span><br><span class="line">s := g.Server()</span><br><span class="line">s.Group(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(group *ghttp.RouterGroup)</span></span> &#123;</span><br><span class="line">group.Middleware(ghttp.MiddlewareHandlerResponse)</span><br><span class="line">group.Bind(</span><br><span class="line">admin.NewV1(),</span><br><span class="line">)</span><br><span class="line">group.Group(<span class="string">&quot;/admin&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(group *ghttp.RouterGroup)</span></span> &#123;</span><br><span class="line">group.Bind(</span><br><span class="line">admin.NewV1(),</span><br><span class="line">)</span><br><span class="line">&#125;)</span><br><span class="line">group.Group(<span class="string">&quot;/article&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(group *ghttp.RouterGroup)</span></span> &#123;</span><br><span class="line">group.Bind(</span><br><span class="line">article.NewV1(),</span><br><span class="line">)</span><br><span class="line">&#125;)</span><br><span class="line">group.Group(<span class="string">&quot;/tags&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(group *ghttp.RouterGroup)</span></span> &#123;</span><br><span class="line">group.Bind(</span><br><span class="line">tags.NewV1(),</span><br><span class="line">)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">s.Run()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>其中group.Bind中的方法均在controller包中，由上一步的gf gen ctrl命令生成。</p><h5 id="编写controller层"><a href="#编写controller层" class="headerlink" title="编写controller层"></a>编写controller层</h5><p>controller层用于接收参数，由logic层实现业务逻辑，再由controller层返回。</p>]]></content>
      
      
      <categories>
          
          <category> GoFrame学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GoFrame </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoFrame新手实战(一)</title>
      <link href="/2024/08/13/goframe-xin-shou-shi-zhan-yi/"/>
      <url>/2024/08/13/goframe-xin-shou-shi-zhan-yi/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言:"></a>引言:</h2><p>在学习一段时间goLang之后，决定用个小项目巩固一下，于是在浏览后发现了一篇心仪的博客界面<a href="https://www.yinkai.cc/">YinKai’s Blog | YinKai’s Blog</a></p><p>框架：<a href="https://hexo.io/zh-cn/docs/">文档 | Hexo</a></p><p>主题：<a href="https://github.com/auroral-ui/hexo-theme-aurora">https://github.com/auroral-ui/hexo-theme-aurora</a></p><p>定好目标后，就可以开始建项了</p><hr><h3 id="建项："><a href="#建项：" class="headerlink" title="建项："></a>建项：</h3><p><strong>版本参考</strong></p><p>ide使用GoLand2024版本</p><p>GoFrame使用V2版本</p><p><strong>建表</strong></p><p>不将用户数据存入数据库，重点关照文章与标签的存储，取消注册与登录，仅作于用nickname发表评论用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">SET NAMES utf8mb4;</span><br><span class="line">SET FOREIGN_KEY_CHECKS = 0;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for admin</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `admin`;</span><br><span class="line">CREATE TABLE `admin`  (</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#x27;博客管理员&#x27;,</span><br><span class="line">  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#x27;密码&#x27;,</span><br><span class="line">  `create_time` datetime(0) NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `update_time` datetime(0) NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  `delete_time` datetime(0) NULL DEFAULT NULL COMMENT &#x27;删除时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`name`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for article</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `article`;</span><br><span class="line">CREATE TABLE `article`  (</span><br><span class="line">  `id` int(0) NOT NULL AUTO_INCREMENT COMMENT &#x27;索引&#x27;,</span><br><span class="line">  `post_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT &#x27;文件名&#x27;,</span><br><span class="line">  `layout` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT &#x27;布局&#x27;,</span><br><span class="line">  `title` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#x27;标题&#x27;,</span><br><span class="line">  `content` mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#x27;内容&#x27;,</span><br><span class="line">  `post` tinyint(1) NULL DEFAULT 0 COMMENT &#x27;是否推荐&#x27;,</span><br><span class="line">  `create_time` datetime(0) NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `update_time` datetime(0) NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  `delete_time` datetime(0) NULL DEFAULT NULL COMMENT &#x27;删除时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for tags</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `tags`;</span><br><span class="line">CREATE TABLE `tags`  (</span><br><span class="line">  `id` int(0) NOT NULL AUTO_INCREMENT COMMENT &#x27;索引&#x27;,</span><br><span class="line">  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#x27;标签名&#x27;,</span><br><span class="line">  `create_time` datetime(0) NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `update_time` datetime(0) NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  `delete_time` datetime(0) NULL DEFAULT NULL COMMENT &#x27;删除时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS = 1;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>在终端中输入<code>gf init demo-blog</code>初始化项目</p><p><img src="https://i-blog.csdnimg.cn/direct/4cc5a67ec8814abc89e3c02293f5e50c.png"></p><p>创建完毕后结构如下:</p><p><img src="https://i-blog.csdnimg.cn/direct/6fa6071005ab48daaeaaae7dc0f1d31a.png"></p><h4 id="goFrame目录结构"><a href="#goFrame目录结构" class="headerlink" title="goFrame目录结构"></a>goFrame目录结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">├── api</span><br><span class="line">├── hack</span><br><span class="line">├── internal</span><br><span class="line">│   ├── cmd</span><br><span class="line">│   ├── consts</span><br><span class="line">│   ├── controller</span><br><span class="line">│   ├── dao</span><br><span class="line">│   ├── logic</span><br><span class="line">│   ├── model</span><br><span class="line">│   |   ├── do</span><br><span class="line">│   │   └── entity</span><br><span class="line">│   └── service</span><br><span class="line">├── manifest</span><br><span class="line">├── resource</span><br><span class="line">├── utility</span><br><span class="line">├── go.mod</span><br><span class="line">└── main.go</span><br><span class="line">resource    静态资源   静态资源文件。这些文件往往可以通过 资源打包/镜像编译 的形式注入到发布文件中。</span><br><span class="line">manifest    交付清单   包含程序编译、部署、运行、配置的文件。常见内容如下：</span><br><span class="line">main.go 入口文件   程序入口文件。</span><br><span class="line">internal    内部逻辑   业务逻辑存放目录。通过Golang internal特性对外部隐藏可见性。</span><br><span class="line">hack    工具脚本   存放项目开发工具、脚本等内容。例如，CLI工具的配置，各种shell/bat脚本等文件。</span><br><span class="line">go.mod  依赖管理   使用Go Module包管理的依赖描述文件。</span><br><span class="line">api 对外接口   对外提供服务的输入/输出数据结构定义。考虑到版本管理需要，往往以api/xxx/v1...存在。</span><br><span class="line">- service   业务接口   用于业务模块解耦的接口定义层。具体的接口实现在logic中进行注入。</span><br><span class="line">- protobuf  协议文件   GRPC协议时使用的protobuf协议定义文件，协议文件编译后生成go文件到api目录。</span><br><span class="line">- model 结构模型   数据结构管理模块，管理数据实体对象，以及输入与输出数据结构定义。</span><br><span class="line">- logic 业务封装   业务逻辑封装管理，特定的业务逻辑实现和封装。往往是项目中最复杂的部分。</span><br><span class="line">  - entity  数据模型   数据模型是模型与数据集合的一对一关系，由工具维护，用户不能修改。</span><br><span class="line">- docker    镜像文件   Docker镜像相关依赖文件，脚本文件等等。</span><br><span class="line">  - do  领域对象   用于dao数据操作中业务模型与实例模型转换，由工具维护，用户不能修改。</span><br><span class="line">- deploy    部署文件   部署相关的文件。默认提供了Kubernetes集群化部署的Yaml模板，通过kustomize管理。</span><br><span class="line">- dao</span><br><span class="line"></span><br><span class="line">数据访问    数据访问对象，这是一层抽象对象，用于和底层数据库交互，仅包含最基础的 CURD 方法</span><br><span class="line">- controller    接口处理   接收/解析用户输入参数的入口/接口层。</span><br><span class="line">- consts</span><br><span class="line">  常量定义</span><br><span class="line"></span><br><span class="line">项目所有常量定义。</span><br><span class="line"></span><br><span class="line">- config    配置管理   配置文件存放目录。</span><br><span class="line">- cmd   入口指令   命令行管理目录。可以管理维护多个命令行。</span><br><span class="line">  对外接口</span><br><span class="line">  对外接口包含两部分：接口定义（api）+接口实现（controller）。</span><br><span class="line"></span><br><span class="line">服务接口的职责类似于三层架构设计中的UI表示层，负责接收并响应客户端的输入与输出，包括对输入参数的过滤、转换、校验，对输出数据结构的维护，并调用 service 实现业务逻辑处理。</span><br><span class="line"></span><br><span class="line">接口定义 - api</span><br><span class="line">api包用于与客户端约定的数据结构输入输出定义，往往与具体的业务场景强绑定。</span><br><span class="line"></span><br><span class="line">接口实现 - controller</span><br><span class="line">controller用于接收api的输入，可以直接在controller中实现业务逻辑，或者调用一个或多个service包实现业务逻辑，将执行结果封装为约定的api输出数据结构。</span><br><span class="line"></span><br><span class="line">业务实现</span><br><span class="line">业务实现包含两部分：业务接口（service）+业务封装（logic）。</span><br><span class="line"></span><br><span class="line">业务实现的职责类似于三层架构设计中的BLL业务逻辑层，负责具体业务逻辑的实现以及封装。</span><br><span class="line"></span><br><span class="line">在后续的章节介绍中，我们会将业务实现统一称作service，大家注意它其实包含两部分即可。</span><br><span class="line"></span><br><span class="line">业务接口 - service</span><br><span class="line">service包用于解耦业务模块之间的调用。业务模块之间往往不会直接调用对应的业务模块资源来实现业务逻辑，而是通过调用service接口。service层只有接口定义，具体的接口实现注入在各个业务模块中。</span><br><span class="line"></span><br><span class="line">业务封装 - logic</span><br><span class="line">logic包负责具体业务逻辑的实现以及封装。项目中各个层级代码不会直接调用logic层的业务模块，而是通过service接口层来调用。</span><br><span class="line"></span><br><span class="line">结构模型</span><br><span class="line">model包的职责类似于三层架构中的Model模型定义层。模型定义代码层中仅包含全局公开的数据结构定义，往往不包含方法定义。</span><br><span class="line"></span><br><span class="line">这里需要注意的是，这里的model不仅负责维护数据实体对象（entity）结构定义，也包括所有的输入/输出数据结构定义，被api/dao/service共同引用。这样做的好处除了可以统一管理公开的数据结构定义，也可以充分对同一业务领域的数据结构进行复用，减少代码冗余。</span><br><span class="line"></span><br><span class="line">数据模型 - entity</span><br><span class="line">与数据集合绑定的程序数据结构定义，通常和数据表一一对应。</span><br><span class="line"></span><br><span class="line">业务模型 - model</span><br><span class="line">与业务相关的通用数据结构定义，其中包含大部分的方法输入输出定义。</span><br><span class="line"></span><br><span class="line">数据访问 - dao</span><br><span class="line">dao包的职责类似于三层架构中的DAL数据访问层，数据访问层负责所有的数据访问收口。</span><br></pre></td></tr></table></figure><p>参考自<a href="https://goframe.org/pages/viewpage.action?pageId=1114119">官方文档</a></p><h3 id="二：配置数据库"><a href="#二：配置数据库" class="headerlink" title="二：配置数据库"></a>二：配置数据库</h3><p>在hack包下编辑config.yaml文件</p><p>添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">database:</span><br><span class="line">  default:</span><br><span class="line">    link: &quot;mysql:root:yujiawei@tcp(127.0.0.1:3306)/blog&quot;</span><br></pre></td></tr></table></figure><p>GoFrame官方文档指示如下:</p><p><code>type:username:password@protocol(address)[/dbname][?param1=value1&amp;...&amp;paramN=valueN]</code>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类型:账号:密码@协议(地址)/数据库名称?特性配置</span><br></pre></td></tr></table></figure><p>测试无误后使用goframe提供的Cli工具生成代码</p><p><code>gf gen dao</code>  </p><p> 参考文档：<br> <a href="https://goframe.org/pages/viewpage.action?pageId=3673173">数据规范-gen dao - GoFrame (ZH)-Latest - GoFrame官网 - 类似PHP-Laravel, Java-SpringBoot的Go企业级开发框架</a></p><p><a href="https://xie.infoq.cn/article/e09ad866d8386f1e052fcf637">GoFrame V2真香，我是Get到了高内聚低耦合的点，你呢？_Go_王中阳Go_InfoQ写作社区</a></p><p><a href="https://gitee.com/goflyfox/gfstudy/tree/master/doc_basic">doc_basic · goflyfox&#x2F;gfstudy - 码云 - 开源中国 (gitee.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> GoFrame学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GoFrame </tag>
            
            <tag> Go </tag>
            
            <tag> blog </tag>
            
            <tag> hexo </tag>
            
            <tag> metry </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(十)</title>
      <link href="/2024/08/13/badminton-m-s10/"/>
      <url>/2024/08/13/badminton-m-s10/</url>
      
        <content type="html"><![CDATA[<p>解决因前后端端口号不同而造成的跨域问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class CrosConfig implements WebMvcConfigurer &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">        registry.addMapping(&quot;/**&quot;)</span><br><span class="line">                .allowedOrigins(&quot;*&quot;)</span><br><span class="line">                .allowedMethods(&quot;GET&quot;,&quot;HEAD&quot;,&quot;POST&quot;,&quot;DELETE&quot;,&quot;OPTIONS&quot;,&quot;PUT&quot;)</span><br><span class="line">                .allowCredentials(true)</span><br><span class="line">                .maxAge(3600)</span><br><span class="line">                .allowedHeaders(&quot;*&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文章参考来源于<a href="https://blog.csdn.net/yi742891270/article/details/107933050">spring boot与VUE的前后端交互_vue和springboot的前后端交互-CSDN博客</a></p><p>学习时出了官方文档，也参考了<a href="http://t.csdnimg.cn/3GCJF">http://t.csdnimg.cn/3GCJF</a> 这个笔记</p><p>目标实现简单的前后端交互。</p>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> vue3 </tag>
            
            <tag> vite </tag>
            
            <tag> 跨域问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(九)</title>
      <link href="/2024/08/13/badminton-m-s9/"/>
      <url>/2024/08/13/badminton-m-s9/</url>
      
        <content type="html"><![CDATA[<ol><li>学习vue3，使用create-vue搭建。学习使用Element plus简化流程</li></ol><p>参考文档:<a href="https://cn.vuejs.org/">https://cn.vuejs.org/</a></p><p>​        <a href="https://element-plus.org/zh-CN/">一个 Vue 3 UI 框架 | Element Plus (element-plus.org)</a></p><p>2.优化了控制层部分代码，使得单个功能减少对数据库的重复访问</p><p>3.为通用接口添加了读取excel文件并将其导入数据库的接口模块，使用了<a href="https://doc.hutool.cn/pages/ExcelUtil/#%E4%BB%8B%E7%BB%8D">hutool</a></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/readExcel&quot;)</span><br><span class="line">    @ApiOperation(&quot;读存excel文件&quot;)</span><br><span class="line">    public Result readExcel(MultipartFile file)&#123;</span><br><span class="line">        if (Validator.isEmpty(file))&#123;</span><br><span class="line">            log.error(&quot;上传文件为空&quot;);</span><br><span class="line">            return Result.error(&quot;上传文件为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(&quot;读取Excel文件:&#123;&#125;&quot;,file);</span><br><span class="line">        try &#123;</span><br><span class="line">            ExcelReader reader = ExcelUtil.getReader(file.getInputStream());</span><br><span class="line">            List&lt;User&gt; users = reader.readAll(User.class);</span><br><span class="line">            int num=userService.addUser(users);</span><br><span class="line">            if (num != 0)&#123;</span><br><span class="line">                log.info(&quot;成功导入&#123;&#125;条数据&quot;,num);</span><br><span class="line">                return Result.success(&quot;成功导入0&quot;+num+&quot;条数据&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;读取Excel文件失败&quot;,e);</span><br><span class="line">        &#125;</span><br><span class="line">    return Result.error(&quot;error&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>项目地址：<a href="https://gitee.com/SuperFishingKingdom/badminton.git">https://gitee.com/SuperFishingKingdom/badminton.git</a></p>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> vue3 </tag>
            
            <tag> ElementPlus </tag>
            
            <tag> create-vue </tag>
            
            <tag> excel文件读取 </tag>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(八)</title>
      <link href="/2024/08/13/badminton-m-s8/"/>
      <url>/2024/08/13/badminton-m-s8/</url>
      
        <content type="html"><![CDATA[<ol><li><p>上传文件到阿里云oss</p></li><li><p>yml文件中配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">数据库名:</span><br><span class="line">  alioss:</span><br><span class="line">    endpoint: </span><br><span class="line">    access-key-id: </span><br><span class="line">    access-key-secret: </span><br><span class="line">    bucket-name: </span><br></pre></td></tr></table></figure><p>在utils中创建AliOssUtil</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class AliOssUtil &#123;</span><br><span class="line"></span><br><span class="line">    private String endpoint;</span><br><span class="line">    private String accessKeyId;</span><br><span class="line">    private String accessKeySecret;</span><br><span class="line">    private String bucketName;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 文件上传</span><br><span class="line">     *</span><br><span class="line">     * @param bytes</span><br><span class="line">     * @param objectName</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String upload(byte[] bytes, String objectName) &#123;</span><br><span class="line"></span><br><span class="line">        // 创建OSSClient实例。</span><br><span class="line">        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            // 创建PutObject请求。</span><br><span class="line">            ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(bytes));</span><br><span class="line">        &#125; catch (OSSException oe) &#123;</span><br><span class="line">            System.out.println(&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span><br><span class="line">                    + &quot;but was rejected with an error response for some reason.&quot;);</span><br><span class="line">            System.out.println(&quot;Error Message:&quot; + oe.getErrorMessage());</span><br><span class="line">            System.out.println(&quot;Error Code:&quot; + oe.getErrorCode());</span><br><span class="line">            System.out.println(&quot;Request ID:&quot; + oe.getRequestId());</span><br><span class="line">            System.out.println(&quot;Host ID:&quot; + oe.getHostId());</span><br><span class="line">        &#125; catch (ClientException ce) &#123;</span><br><span class="line">            System.out.println(&quot;Caught an ClientException, which means the client encountered &quot;</span><br><span class="line">                    + &quot;a serious internal problem while trying to communicate with OSS, &quot;</span><br><span class="line">                    + &quot;such as not being able to access the network.&quot;);</span><br><span class="line">            System.out.println(&quot;Error Message:&quot; + ce.getMessage());</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (ossClient != null) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //文件访问路径规则 https://BucketName.Endpoint/ObjectName</span><br><span class="line">        StringBuilder stringBuilder = new StringBuilder(&quot;https://&quot;);</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(bucketName)</span><br><span class="line">                .append(&quot;.&quot;)</span><br><span class="line">                .append(endpoint)</span><br><span class="line">                .append(&quot;/&quot;)</span><br><span class="line">                .append(objectName);</span><br><span class="line"></span><br><span class="line">        log.info(&quot;文件上传到:&#123;&#125;&quot;, stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        return stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考自阿里云官方文档</p><p>创建properties类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;badminton.alioss&quot;)</span><br><span class="line">@Data</span><br><span class="line">public class AliOssProperties &#123;</span><br><span class="line"></span><br><span class="line">    private String endpoint;</span><br><span class="line">    private String accessKeyId;</span><br><span class="line">    private String accessKeySecret;</span><br><span class="line">    private String bucketName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在控制层创建CommonController控制文件的上传</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/admin/common&quot;)</span><br><span class="line">@Api(tags = &quot;通用接口&quot;)</span><br><span class="line">@Slf4j</span><br><span class="line">public class CommonController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private AliOssUtil aliOssUtil;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;/upload&quot;)</span><br><span class="line">    @ApiOperation(&quot;上传图片&quot;)</span><br><span class="line">    public Result&lt;String&gt; upload(MultipartFile file)&#123;</span><br><span class="line">        if (Validator.isEmpty(file))&#123;</span><br><span class="line">            log.error(&quot;上传文件为空&quot;);</span><br><span class="line">            return Result.error(&quot;上传文件为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(&quot;上传文件:&#123;&#125;&quot;,file);</span><br><span class="line">        try &#123;</span><br><span class="line">            //原始文件名</span><br><span class="line">            String originalFilename = file.getOriginalFilename();</span><br><span class="line">            //截取原始文件名的后缀</span><br><span class="line">            String extension = originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));</span><br><span class="line">            //用UUID覆盖原文件名</span><br><span class="line">            String objectName =IdUtil.simpleUUID()+extension;</span><br><span class="line">            //文件请求路径</span><br><span class="line">            String filePath=aliOssUtil.upload(file.getBytes(),objectName);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;上传文件失败&quot;,e);</span><br><span class="line">        &#125;</span><br><span class="line">        return Result.error(&quot;error&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>设置类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@Slf4j</span><br><span class="line">public class OssConfiguration &#123;</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    @Bean</span><br><span class="line">    public AliOssUtil aliOssUtil(AliOssProperties aliOssProperties)&#123;</span><br><span class="line">        log.info(&quot;开始创建阿里云文件上传工具类对象&quot;,aliOssProperties);</span><br><span class="line">        return new AliOssUtil(aliOssProperties.getEndpoint(),</span><br><span class="line">                aliOssProperties.getAccessKeyId(),</span><br><span class="line">                aliOssProperties.getAccessKeySecret(),</span><br><span class="line">                aliOssProperties.getBucketName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> alioss </tag>
            
            <tag> 上传文件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(七)</title>
      <link href="/2024/08/13/badminton-m-s7/"/>
      <url>/2024/08/13/badminton-m-s7/</url>
      
        <content type="html"><![CDATA[<ol><li><p>打包项目</p><p>在idea中用clean和install打包</p><p><img src="https://i-blog.csdnimg.cn/direct/1f7595c165f64fb29baed79ef092acbc.png"></p></li><li><p>上传到虚拟机的&#x2F;root目录中，重命名为demo.jar,运行<code>java -jar demo.jar &amp;</code>命令，结果报错</p><p><img src="https://i-blog.csdnimg.cn/direct/44c1b8d7f5184e4d960bbf81c4d4f5ca.png"></p></li></ol><p>​搜索后发现是linux中的jdk版本较低的原因，将jdk更新到<a href="https://blog.csdn.net/weixin_59539033/article/details/127650750">jdk17版本</a></p><p>​成功结果如图</p><p>​<img src="https://i-blog.csdnimg.cn/direct/9799610be10e41febe94d82e89ed521e.png"></p><p>​再次运行以上命令，成功部署项目，在关闭防火墙后，根据端口和虚拟机ip测试访问</p><p>​<img src="https://i-blog.csdnimg.cn/direct/2b959402f6064e2ca3a9fe824f8bb72c.png"></p><p>成功</p><ol start="3"><li><p>使用supervisor启动进程实现自动重启服务<a href="https://blog.csdn.net/xjxy52o/article/details/132178791">教程</a></p><pre><code>  完成了supervisor的配置后</code></pre></li></ol><p>​<img src="https://i-blog.csdnimg.cn/direct/ed4b39ea932b422982e3a3071a375aba.png"></p><p>​在使用kill进程测试后发现无法实现自动重启，再次百度。发现是true的问题，将autorestart&#x3D;true改为autorestart&#x3D;unexpected。更新并重启再测试，成功实现了自动重启功能</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[program:demo]</span><br><span class="line">command=//usr/lib/jdk17/jdk-17.0.11/bin/java -jar demo.jar &amp;</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=unexpected</span><br><span class="line">directory=/root</span><br><span class="line">user=root</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> linux </tag>
            
            <tag> 部署jar包 </tag>
            
            <tag> supervisor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(六)</title>
      <link href="/2024/08/13/badminton-m-s6/"/>
      <url>/2024/08/13/badminton-m-s6/</url>
      
        <content type="html"><![CDATA[<ol><li><p>配置事务管理，使用@Transaction注解配置，<a href="https://mybatis-flex.com/zh/core/tx.html">参考文档</a></p></li><li><p>为读取操作设置缓存</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@Slf4j</span><br><span class="line">public class RedisConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123;</span><br><span class="line">        RedisTemplate redisTemplate = new RedisTemplate();</span><br><span class="line">        //设置redis的连接工厂对象</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        //设置redis key的序列化器</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置reids连接:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data:</span><br><span class="line">  redis:</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 6379</span><br><span class="line">    password: &quot;yujiawei330702&quot;</span><br><span class="line">    database: 1</span><br></pre></td></tr></table></figure><p>将实现类改为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class SiteInfoServiceImpl extends CacheableServiceImpl&lt;SiteInfoMapper, SiteInfo&gt; implements SiteInfoService </span><br></pre></td></tr></table></figure><p>3.测试缓存是否成功配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    @Cacheable(key = &quot;#id&quot;)</span><br><span class="line">    public SiteInfo getSiteState(Integer id) &#123;</span><br><span class="line">        /*QueryWrapper queryWrapper = new QueryWrapper();</span><br><span class="line">        queryWrapper.select(&quot;site_state&quot;)</span><br><span class="line">                .from(&quot;site_info&quot;)</span><br><span class="line">                .where(&quot;site_code=?&quot;,id);</span><br><span class="line">        return queryWrapper.hasCondition();*/</span><br><span class="line">        SiteInfo siteInfo = siteInfoMapper.selectOneById(id);</span><br><span class="line">        return siteInfo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>在apifox中测试接口,输入数据，redis中出现数据:</p></li></ol><p>​<img src="https://i-blog.csdnimg.cn/direct/ece3caa6c5fc4e1693444ba6f08b4793.png"></p><p>接着在测试类中测试读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test5()&#123;</span><br><span class="line">System.out.println(redisTemplate.opsForValue().get(&quot;siteInfo::13&quot;));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>出现结果</p><p><img src="https://i-blog.csdnimg.cn/direct/2ccf89ca9b3742099c6552204e4f8d75.png"></p><p>成功</p>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> springboot </tag>
            
            <tag> java </tag>
            
            <tag> 事务管理 </tag>
            
            <tag> redis </tag>
            
            <tag> 缓存 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(五)</title>
      <link href="/2024/08/13/badminton-m-s5/"/>
      <url>/2024/08/13/badminton-m-s5/</url>
      
        <content type="html"><![CDATA[<ol><li>完成其余功能的CRUD，完成后在接口文档中测试</li><li>修改完善功能，完善数据校验</li><li>为部分表添加乐观锁，同时在表中新增version字段</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Column(version = true)</span><br><span class="line">   private Integer version;</span><br></pre></td></tr></table></figure><p>乐观锁：<a href="https://mybatis-flex.com/zh/core/version.html">MyBatis-Flex 乐观锁 - MyBatis-Flex 官方网站</a></p><ol start="4"><li><p>增加token和拦截器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; payLoad=new HashMap&lt;String,Object&gt;()&#123;</span><br><span class="line">            private static final long serialVersionUID = 1L;&#123;</span><br><span class="line">                put(&quot;adminId&quot;,admin1.getAdminId());</span><br><span class="line">                put(&quot;adminName&quot;,admin1.getAdminName());</span><br><span class="line">                put(&quot;adminPassword&quot;,admin1.getAdminPassword());</span><br><span class="line">                put(&quot;adminState&quot;,admin1.getAdminState());</span><br><span class="line">                put(&quot;roles&quot;,&quot;admin&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        String token= JWTUtil.createToken(payLoad,&quot;123&quot;.getBytes());</span><br></pre></td></tr></table></figure></li><li><p>为密码加密</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Argon2 argon2 = Argon2Factory.create(Argon2Factory.Argon2Types.ARGON2id);//Argon2加密</span><br><span class="line">               int memory = 65536; // 内存使用量，单位是KB</span><br><span class="line">               int parallelism = 2; // 并行度</span><br><span class="line">               int iterations = 3; // 迭代次数</span><br><span class="line">               String hash=argon2.hash(iterations,memory,parallelism,adminDto.getAdminPassword().toCharArray());</span><br><span class="line">               admin.setAdminPassword(hash);</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> springboot </tag>
            
            <tag> java </tag>
            
            <tag> 乐观锁 </tag>
            
            <tag> jwt </tag>
            
            <tag> argon2加密 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(四)</title>
      <link href="/2024/08/13/badminton-m-s4/"/>
      <url>/2024/08/13/badminton-m-s4/</url>
      
        <content type="html"><![CDATA[<ol><li><p>添加@Slf4j,增加@Api注释方便后期功能接口调试</p></li><li><p>为方法添加@ApiOperation</p></li><li><p>控制器负责接收数据，检验数据，将数据传到service层，在service层处理数据。返回给控制器</p></li><li><p>查询操作全部设置为分页查询，方便查询与前端操作。这里使用了mybatis-flex中的Page方法</p></li><li><p>校验数据的操作使用了hutool的Validate方法。官方文档:<a href="https://plus.hutool.cn/apidocs/">在这里</a></p></li><li><p>以下为编写的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;场地信息管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/siteInfo&quot;)</span></span><br><span class="line"><span class="comment">//控制器负责接受数据，校验数据，然后把数据丢给service，然后返回service给你的结果</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SiteInfoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SiteInfoService siteInfoService;</span><br><span class="line"><span class="comment">//新增场地</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addSite&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增场地&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> SiteInfo siteInfo)</span><span class="comment">//SiteInfoDto siteInfoDto</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//校验数据</span></span><br><span class="line">        <span class="keyword">if</span>(siteInfo.getSiteCode()==<span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            log.error(<span class="string">&quot;空数据&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地编号不能为空&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (siteInfoService.isExisted(siteInfo.getSiteCode()))&#123;<span class="comment">//判断是否存在相同的场地编号</span></span><br><span class="line">            log.error(<span class="string">&quot;场地编号已存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地编号已存在&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (siteInfo.getSiteState()==<span class="literal">null</span>)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;场地状态不能为空&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地状态不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;新增场地:&#123;&#125;&quot;</span>,siteInfo);</span><br><span class="line">        siteInfoService.addSite(siteInfo);</span><br><span class="line">        <span class="keyword">return</span> Result.success(siteInfo);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除场地&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!siteInfoService.isExisted(id))&#123;</span><br><span class="line">            log.error(<span class="string">&quot;场地id:&#123;&#125;不存在&quot;</span>,id);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地&quot;</span>+id+<span class="string">&quot;不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//todo判断是否存在需要删除的字段</span></span><br><span class="line">        <span class="comment">//用场地编号删除</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (siteInfoService.deleteLogically(id)==<span class="number">1</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;已删除场地id:&#123;&#125;&quot;</span>,id);</span><br><span class="line">            <span class="keyword">return</span> Result.success();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;删除场地&quot;</span>+id+<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@PutMapping(&quot;updateSiteState&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;更改场地状态&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateSiteState</span><span class="params">(<span class="meta">@RequestBody</span> SiteInfo siteInfo)</span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//        log.info(&quot;更改场地状态:&#123;&#125;&quot;,siteInfo);</span></span><br><span class="line">        <span class="keyword">if</span> (Validator.isEmpty(siteInfo))&#123;</span><br><span class="line">            log.error(<span class="string">&quot;传入的类型为空&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;传入的类型为空&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (Validator.isEmpty(siteInfo.getSiteCode()))&#123;</span><br><span class="line">            log.error(<span class="string">&quot;场地编号不能为空&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地编号不能为空&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Validator.isEmpty(siteInfo.getSiteState()))&#123;</span><br><span class="line">            log.error(<span class="string">&quot;场地状态不能为空&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地状态不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (siteInfoService.isDeletedLogically(siteInfo.getSiteCode()))&#123;</span><br><span class="line">            log.error(<span class="string">&quot;场地已删除&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;场地已删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (siteInfoService.setSiteState(siteInfo))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;更改场地状态:&#123;&#125;&quot;</span>,siteInfo.getSiteState());</span><br><span class="line">            <span class="keyword">return</span> Result.success(<span class="string">&quot;已更改为&quot;</span>+siteInfo.getSiteState());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">&quot;更改场地状态失败:&#123;&#125;&quot;</span>,siteInfo.getSiteState());</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;更改场地状态失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        return siteInfoService.getSiteState(siteInfo.getSiteCode());</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@GetMapping(&quot;getSiteState&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;查询哪些场地被占用&quot;)</span><span class="comment">//分页查询</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Page&lt;SiteInfo&gt;&gt; <span class="title function_">getSiteState</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        Page result=siteInfoService.selectSiteState();</span><br><span class="line">        <span class="keyword">if</span> (siteInfoService.selectSiteState()!=<span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;查询成功，被占用的场地为:&#123;&#125;&quot;</span>,result);</span><br><span class="line">            <span class="keyword">return</span> Result.success(result);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">&quot;查询失败&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;查询失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">//1.日志输出在返回前端之前 2.控制器校验数据 3.使用统一的返回类型Result</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> springboot </tag>
            
            <tag> java </tag>
            
            <tag> mybatis-flex </tag>
            
            <tag> mybatis </tag>
            
            <tag> hutool </tag>
            
            <tag> 分页查询 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(三)</title>
      <link href="/2024/08/13/badminton-m-s3/"/>
      <url>/2024/08/13/badminton-m-s3/</url>
      
        <content type="html"><![CDATA[<h1 id="三：mybatis-flex代码生成器"><a href="#三：mybatis-flex代码生成器" class="headerlink" title="三：mybatis-flex代码生成器"></a>三：mybatis-flex代码生成器</h1><ol><li><p>使用mybatis-flex的代码生成器快速生成代码和结构</p><p>使用的Maven依赖如下</p><p><code>&lt;dependency&gt;</code>  </p><p>​    <code>&lt;groupId&gt;com.mybatis-flex&lt;/groupId&gt;</code><br>​    <code>&lt;artifactId&gt;mybatis-flex-spring-boot3-starter&lt;/artifactId&gt;</code>  </p><p>​    <code>&lt;version&gt;1.9.3&lt;/version&gt;</code>  </p><p><code>&lt;/dependency&gt;</code>  </p><p><code>&lt;dependency&gt;</code>  </p><p>​    <code>&lt;groupId&gt;com.mybatis-flex&lt;/groupId&gt;</code>  </p><p><code>    &lt;artifactId&gt;mybatis-flex-processor&lt;/artifactId&gt;</code>  </p><p><code>    &lt;version&gt;1.9.3&lt;/version&gt;</code>  </p><p><code>    &lt;scope&gt;provided&lt;/scope&gt;</code>  </p><p><code>&lt;/dependency&gt;</code>  </p></li><li><p>在pom.xml同级目录下创建mybatis-flex.config文件并配置</p><p><code>#开启 Mapper 自动生成</code>  </p><p><code>processor.mapper.generateEnable = true</code>  </p><p><code># 开启 @Mapper 注解</code>  </p><p><code>processor.mapper.annotation = true</code>  </p></li><li><p>在启动项同级目录下创建mybatis-flex代码生成器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">public class Codegen &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //配置数据源</span><br><span class="line">        HikariDataSource dataSource = new HikariDataSource();</span><br><span class="line">        dataSource.setJdbcUrl(&quot;jdbc:mysql://127.0.0.1:3306/badminton?characterEncoding=utf-8&quot;);</span><br><span class="line">        dataSource.setUsername(&quot;root&quot;);</span><br><span class="line">        dataSource.setPassword(&quot;yujiawei&quot;);</span><br><span class="line"></span><br><span class="line">        //创建配置内容，两种风格都可以。</span><br><span class="line">//        GlobalConfig globalConfig = createGlobalConfigUseStyle1();</span><br><span class="line">        GlobalConfig globalConfig = createGlobalConfigUseStyle2();</span><br><span class="line"></span><br><span class="line">        //通过 datasource 和 globalConfig 创建代码生成器</span><br><span class="line">        Generator generator = new Generator(dataSource, globalConfig);</span><br><span class="line"></span><br><span class="line">        //生成代码</span><br><span class="line">        generator.generate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static GlobalConfig createGlobalConfigUseStyle1() &#123;</span><br><span class="line">        //创建配置内容</span><br><span class="line">        GlobalConfig globalConfig = new GlobalConfig();</span><br><span class="line"></span><br><span class="line">        //设置根包</span><br><span class="line">        globalConfig.setBasePackage(&quot;com.badminton.demo&quot;);</span><br><span class="line"></span><br><span class="line">        //设置表前缀和只生成哪些表</span><br><span class="line">//        globalConfig.setTablePrefix(&quot;tb_&quot;);</span><br><span class="line">//        globalConfig.setGenerateTable(&quot;tb_account&quot;, &quot;tb_account_session&quot;);</span><br><span class="line"></span><br><span class="line">        //设置生成 entity 并启用 Lombok</span><br><span class="line">        globalConfig.setEntityGenerateEnable(true);</span><br><span class="line">        globalConfig.setEntityWithLombok(true);</span><br><span class="line">        //设置项目的JDK版本，项目的JDK为14及以上时建议设置该项，小于14则可以不设置</span><br><span class="line">//        globalConfig.setJdkVersion(17);</span><br><span class="line"></span><br><span class="line">        //设置生成 mapper</span><br><span class="line">        globalConfig.setMapperGenerateEnable(true);</span><br><span class="line"></span><br><span class="line">        //可以单独配置某个列</span><br><span class="line">        ColumnConfig columnConfig = new ColumnConfig();</span><br><span class="line">        columnConfig.setColumnName(&quot;tenant_id&quot;);</span><br><span class="line">        columnConfig.setLarge(true);</span><br><span class="line">        columnConfig.setVersion(true);</span><br><span class="line">        globalConfig.setColumnConfig(&quot;tb_account&quot;, columnConfig);</span><br><span class="line"></span><br><span class="line">        return globalConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static GlobalConfig createGlobalConfigUseStyle2() &#123;</span><br><span class="line">        //创建配置内容</span><br><span class="line">        GlobalConfig globalConfig = new GlobalConfig();</span><br><span class="line"></span><br><span class="line">        //设置根包</span><br><span class="line">        globalConfig.getPackageConfig()</span><br><span class="line">                .setBasePackage(&quot;com.badminton.demo&quot;);</span><br><span class="line"></span><br><span class="line">        //设置表前缀和只生成哪些表，setGenerateTable 未配置时，生成所有表</span><br><span class="line">//        globalConfig.getStrategyConfig()</span><br><span class="line">//                .setTablePrefix(&quot;tb_&quot;)</span><br><span class="line">//                .setGenerateTable(&quot;tb_account&quot;, &quot;tb_account_session&quot;);</span><br><span class="line"></span><br><span class="line">        //设置生成 entity 并启用 Lombok</span><br><span class="line">        globalConfig.enableEntity()</span><br><span class="line">                .setWithLombok(true)</span><br><span class="line">                .setJdkVersion(17);</span><br><span class="line"></span><br><span class="line">        //设置生成 mapper</span><br><span class="line">        globalConfig.enableMapper();</span><br><span class="line">        // 开启 Entity 的生成</span><br><span class="line">        globalConfig.enableEntity();</span><br><span class="line">        //开启service的生成</span><br><span class="line">        globalConfig.enableService();</span><br><span class="line">        //开启serviceImpl的生成</span><br><span class="line">        globalConfig.enableServiceImpl();</span><br><span class="line">        //开启controller的生成</span><br><span class="line">        globalConfig.enableController();</span><br><span class="line">// 关闭 Entity 的生成</span><br><span class="line">//        globalConfig.disableEntity();</span><br><span class="line">        //可以单独配置某个列</span><br><span class="line">        /*</span><br><span class="line">        ColumnConfig columnConfig = new ColumnConfig();</span><br><span class="line">        columnConfig.setColumnName(&quot;tenant_id&quot;);</span><br><span class="line">        columnConfig.setLarge(true);</span><br><span class="line">        columnConfig.setVersion(true);</span><br><span class="line">        globalConfig.getStrategyConfig()</span><br><span class="line">                .setColumnConfig(&quot;tb_account&quot;, columnConfig);</span><br><span class="line">                */</span><br><span class="line"></span><br><span class="line">        return globalConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>部分参考了<a href="https://blog.csdn.net/sgx1825192/article/details/134116973">mybatis-flex官方文档</a></p></li><li><p>运行以上代码，代码生成器自动创建了所需要的文件例如controller，entity，mapper与service</p><p><img src="https://sky-take-out-super-fish.oss-cn-beijing.aliyuncs.com/tuchuang/202408140900676.png" alt="图片"></p></li><li><p>选择一个表crud</p></li><li><p>为返回结果规定一个统一的返回值{code,message,data}</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：0成功，1和其它数字为失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.data = object;</span><br><span class="line">        result.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.msg = msg;</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> springboot </tag>
            
            <tag> java </tag>
            
            <tag> mybatis-flex </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(二)</title>
      <link href="/2024/08/13/badminton-m-s2/"/>
      <url>/2024/08/13/badminton-m-s2/</url>
      
        <content type="html"><![CDATA[<h1 id="二：优化数据库，进行CRUD"><a href="#二：优化数据库，进行CRUD" class="headerlink" title="二：优化数据库，进行CRUD"></a>二：优化数据库，进行CRUD</h1><ol><li><p>为方便进行springboot项目的创建，使用了<a href="https://start.spring.io/">该网站</a>进行创建并初始化项目</p><p>orm则使用了<a href="https://mybatis-flex.com/">Mybatis-flex</a></p></li><li><p>优化主键为自增主键，方便查询</p></li><li><p>gitee创建仓库存放代码</p></li><li><p>为项目配置数据库application.yml</p></li></ol><p><code>sever:</code>  </p><p>​<code>port: 8080</code>  </p><p><code>spring:</code>  </p><pre><code> `datasource:`  </code></pre><p>​<code>password: yujiawei</code>  </p><p>​<code>url: jdbc:mysql://localhost:3306/badminton?useSSL=false&amp;serverTimezone=UTC</code>  </p><p>​<code>driver-class-name: com.mysql.cj.jdbc.Driver</code>  </p>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> navicat </tag>
            
            <tag> 数据库 </tag>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
            <tag> springboot </tag>
            
            <tag> java </tag>
            
            <tag> mybatis-flex </tag>
            
            <tag> mybatis </tag>
            
            <tag> orm </tag>
            
            <tag> gitee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>球场预约管理系统后端开发(一)</title>
      <link href="/2024/08/12/badminton-m-s1/"/>
      <url>/2024/08/12/badminton-m-s1/</url>
      
        <content type="html"><![CDATA[<p>项目仓库：<a href="https://gitee.com/SuperFishingKingdom/badminton.git">https://gitee.com/SuperFishingKingdom/badminton.git</a></p><h1 id="一：数据库的建表"><a href="#一：数据库的建表" class="headerlink" title="一：数据库的建表"></a>一：数据库的建表</h1><ol><li><p>系统面向用户与管理员。功能包括预约，场地管理等。  </p><p>使用mysql作为数据库。</p></li><li><p>在构建好所需表后，为每个表新增create_time,update_time,delete_time字段,</p><p> 其中<strong>delete_time用于判断该表是否删除</strong></p></li><li><p>设置部分字段编码格式为<strong>utf-8mb4 general ci</strong>,支持表情符号等</p></li><li><p>为长文本格式的字段设置为<strong>mediumtex</strong>，将逻辑判断的字段类型设置为<strong>tinyInt</strong>，长度为<strong>1</strong></p></li><li><p>为每个字段编写注释</p></li></ol><p>&#96;SET NAMES utf8mb4;<br>SET FOREIGN_KEY_CHECKS &#x3D; 0;</p><hr><p>– Table structure for admin</p><hr><p>DROP TABLE IF EXISTS <code>admin</code>;<br>CREATE TABLE <code>admin</code>  (<br>  <code>admin_id</code> int(0) NOT NULL AUTO_INCREMENT COMMENT ‘管理员id’,<br>  <code>admin_name</code> varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT ‘管理员账号’,<br>  <code>admin_password</code> varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT ‘管理员密码’,<br>  <code>admin_state</code> tinyint(1) NOT NULL DEFAULT 1 COMMENT ‘账号是否封禁’,<br>  <code>create_time</code> datetime(0) NOT NULL COMMENT ‘创建时间’,<br>  <code>delete_time</code> datetime(0) NULL DEFAULT NULL COMMENT ‘删除时间’,<br>  <code>update_time</code> datetime(0) NOT NULL COMMENT ‘修改时间’,<br>  PRIMARY KEY (<code>admin_id</code>) USING BTREE<br>) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 11 CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</p><hr><p>– Table structure for article</p><hr><p>DROP TABLE IF EXISTS <code>article</code>;<br>CREATE TABLE <code>article</code>  (<br>  <code>id</code> int(0) NOT NULL AUTO_INCREMENT COMMENT ‘文章id’,<br>  <code>title</code> varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT ‘文章标题’,<br>  <code>content</code> mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL COMMENT ‘文章内容’,<br>  <code>topping</code> tinyint(1) NOT NULL DEFAULT 0 COMMENT ‘是否置顶（0|1）’,<br>  <code>admin_id</code> int(0) NOT NULL COMMENT ‘上传者id’,<br>  <code>delete_time</code> datetime(0) NULL DEFAULT NULL COMMENT ‘删除时间’,<br>  <code>update_time</code> datetime(0) NOT NULL COMMENT ‘修改时间’,<br>  <code>create_time</code> datetime(0) NOT NULL COMMENT ‘上传时间’,<br>  PRIMARY KEY (<code>id</code>) USING BTREE<br>) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 6 CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</p><hr><p>– Table structure for booking_info</p><hr><p>DROP TABLE IF EXISTS <code>booking_info</code>;<br>CREATE TABLE <code>booking_info</code>  (<br>  <code>site_code</code> int(0) NOT NULL COMMENT ‘场地编号’,<br>  <code>user_id</code> int(0) NOT NULL COMMENT ‘预约的用户id’,<br>  <code>id_time</code> int(0) NOT NULL COMMENT ‘预约时间对应的id编号’,<br>  <code>create_time</code> datetime(0) NOT NULL COMMENT ‘上传时间’,<br>  <code>delete_time</code> datetime(0) NULL DEFAULT NULL COMMENT ‘删除时间’,<br>  <code>update_time</code> datetime(0) NOT NULL COMMENT ‘修改时间’,<br>  <code>version</code> int(0) NULL DEFAULT 1 COMMENT ‘乐观锁’,<br>  PRIMARY KEY (<code>user_id</code>) USING BTREE<br>) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</p><hr><p>– Table structure for booking_time</p><hr><p>DROP TABLE IF EXISTS <code>booking_time</code>;<br>CREATE TABLE <code>booking_time</code>  (<br>  <code>site_code</code> int(0) NOT NULL COMMENT ‘场地编号’,<br>  <code>id</code> int(0) NOT NULL COMMENT ‘时间段id’,<br>  <code>time</code> varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT ‘id对应的时间段’,<br>  <code>create_time</code> datetime(0) NOT NULL COMMENT ‘上传时间’,<br>  <code>delete_time</code> datetime(0) NULL DEFAULT NULL COMMENT ‘删除时间’,<br>  <code>update_time</code> datetime(0) NOT NULL COMMENT ‘修改时间’,<br>  PRIMARY KEY (<code>id</code>) USING BTREE<br>) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</p><hr><p>– Table structure for site_info</p><hr><p>DROP TABLE IF EXISTS <code>site_info</code>;<br>CREATE TABLE <code>site_info</code>  (<br>  <code>site_code</code> int(0) NOT NULL COMMENT ‘场地编号’,<br>  <code>site_state</code> tinyint(1) NOT NULL COMMENT ‘是否有其他活动正在举办’,<br>  <code>create_time</code> datetime(0) NOT NULL COMMENT ‘上传时间’,<br>  <code>delete_time</code> datetime(0) NULL DEFAULT NULL COMMENT ‘删除时间’,<br>  <code>update_time</code> datetime(0) NOT NULL COMMENT ‘修改时间’,<br>  PRIMARY KEY (<code>site_code</code>) USING BTREE<br>) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</p><hr><p>– Table structure for user</p><hr><p>DROP TABLE IF EXISTS <code>user</code>;<br>CREATE TABLE <code>user</code>  (<br>  <code>user_id</code> int(0) NOT NULL AUTO_INCREMENT COMMENT ‘用户id’,<br>  <code>user_name</code> varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT ‘用户账号’,<br>  <code>user_password</code> varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT ‘用户密码’,<br>  <code>sex</code> tinyint(1) NULL DEFAULT 1 COMMENT ‘用户性别’,<br>  <code>phone</code> varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT ‘电话号码’,<br>  <code>info</code> varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT ‘用户信息’,<br>  <code>user_state</code> tinyint(1) NOT NULL DEFAULT 1 COMMENT ‘账号是否被封禁’,<br>  <code>update_time</code> datetime(0) NOT NULL COMMENT ‘修改时间’,<br>  <code>delete_time</code> datetime(0) NULL DEFAULT NULL COMMENT ‘删除时间’,<br>  <code>create_time</code> datetime(0) NOT NULL COMMENT ‘上传时间’,<br>  PRIMARY KEY (<code>user_id</code>, <code>user_name</code>) USING BTREE<br>) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 20 CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</p><p>SET FOREIGN_KEY_CHECKS &#x3D; 1;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> 球场预约管理系统后端开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> sql </tag>
            
            <tag> navicat </tag>
            
            <tag> 数据库 </tag>
            
            <tag> badminton </tag>
            
            <tag> 后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/08/12/hello-world/"/>
      <url>/2024/08/12/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
